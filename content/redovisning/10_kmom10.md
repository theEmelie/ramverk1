---
---
Redovisning kmom10
=========================

##### Krav 1-3
Jag har valt att skydda det mesta utav inloggning. Man kan se förstasidan och om sidan utan att vara inloggad. Men om du vill klicka dig in på något så måste du vara inloggad,
och för att göra det har jag skapat ett användarformulär för inloggning och skapa en användare, och där använder jag mig utav HTMLForm modelen, och det i sin tur använder sig utav en ActiveRecordModel databas, och det har jag använt för alla klasser i detta projekt. I HTMLForm klassen för att skapa en användare sparar jag all data ifrån formuläret som man sedan kan jämföra med när man ska logga in. Och för att kontrollera att användaren är inloggad för att kolla på vissa sidor så hämtar vi sessionen och kollar att ett användarnamn är sparat där, är det inte det, så blir man skickad till inloggningssidan. För att ge användaren en Gravatar, så har jag använt mig utav koden på [Gravatar](https://sv.gravatar.com/site/implement/images/php/), den kollar på användarens email och har användaren en Gravatar så vissas den, annars använder den sig utav en default bild. I UserContoller så har jag en indexActionGet som är profilen för en användare och där kallar vi på en funktion som hämtar användar datan genom att kolla på användarens id.  Och där visar vi användarens Gravatar, en logga ut länk, och länk för att ändra email och lösenord, vilket görs på ett likt sätt som att skapa en användare, men med andra fält.

Sedan vill vi att användaren ska kunna ställa frågor och svara på frågor samt lägga till kommentarer. För att göra detta måste vi skapa nya tabeller i databasen, frågor och kommenterar kommer inte ha en kontroller, utav det kommer finnas i fråga kontrollern, och i den kontrollern är våran centrala klass, allt utgår ifrån den. Kommentarerna är uppdelade i två tabeller, QComments (kommenterar för frågor) och AComments (kommenterar för svar). För alla de här fyra tabellerna behöver vi använda oss utav HTMLForm, och dom är alla hyfsat lika. Vi vill spara texten som använder skriver i våran formulär. För att kunna fråga en fråga så har jag en AskAction i QuestionController, det enda vi gör där är att hämta formulärat och dess data, som sedan ritas upp i ett formulär, och vi gör även samma för svar och kommentarer. Hur dom är kopplade till varandra är igenom att AComments sparar answerId (svar id:et) och de andra tre tabellerna sparar questionId (fråga id:et). Och dom är satta till ett gömt fält i våra formulär.

Sedan vill vi även koppla användaren till de frågor/svar/kommentarer som de gjort, jag lägger till en länk på användarens profil som heter "User activity" där man kan se allt en användare har gjort, vi börjar med att hämta alla data om användaren, sen har vi fyra olika funktioner som kollar i databasen vilka frågor/svar/kommentarer som användaren har gjort genom att göra en findAllWhere() och så kollar vi på användarens id.

Sedan vill vi kunna lägga till taggar på våra frågor, för att göra det börjar vi med att skapa två nya tabeller i databasen. En för att skapa en ny tagg och den andra är för att kunna koppla en tagg till en fråga. Vi måste gå tillbaka till vårat frågeformulär. Där vill vi nu lägga till ett nytt fält där man kan lägga till taggar. Lite längre ner i filen vill vi att användaren ska kunna ha flera taggar på en fråga men alla ska vara unika, så vi använder oss utav array_unique som inte kommer returnera duplicerade värden, och vi separerar taggarna med hjälp utav kommatecken, vi kollar sedan om taggen finns eller inte genom en funktion som kollar i våran databas, finns den inte så lägger vi till den i databasen. Sedan sparar vi även taggen i våran andra tabell så vi senare kan koppla taggen till en fråga. Vi har en TagController där vi har en indexAction som listar alla taggar. För att sedan koppla en tagg till en fråga har jag en getTagNames funktion i QuestionController, den hämtar alla frågor med det specifika tagg id:et, och sedan gör vi en loop för att hämta alla taggar. Sedan har vi en annan funktion viewTagAction, där hämtar vi igen alla taggar och sedan vill vi loopa igenom dom och se vilka frågor som har en koppling till taggen, vi lägger sedan till allt i en array, som gör det enklare att hämta ut i våran vy.

Nu vill vi tillslut lägga till alla svar och kommentarer som är kopplade till en fråga i en vy, så i våran QuestionController har jag en viewAction, den tar emot fråga id:et och vi börjar med att hämta frågan som vi klickat på genom att kolla id:et. Vi hämtar sedan användaren och lägger till den i våran question array, som vi har skapat genom att göra $question = new Questions(), sedan gör vi samma sak med taggarna och lägger till dom i question array och även med QComments, sedan vill vi skapa en ny answer array där vi hämtar alla svar för en specifik fråga genom att göra findAllWhere() och vi hämtar sedan våra AComments och lägger till dom i answer arrayen.

Sedan vill vi att man ska kunna använda markdown när man skriver frågor och svar. Jag kör en markdown funktion på question->text och ans->text som är i viewAction. Markdown funktionen ligger i en egen klass som heter MyTextfilter, och den finns en inbyggd markdown funktion så allt vi behöver göra är en markdown($text) för att konvertera texten till markdown. Jag gör även markdown på kommenterarna men det görs i QComments och AComments klasserna.

Tillsist vill vi ha en framsida där vi kan se dom senaste frågorna, med aktiva användare och populära taggar. För att göra det skapar jag en ny controller, FrontpageController, som har en indexAction, där börjar vi med att hämta alla frågor, och sedan kallar vi på en funktion som sorterar frågorna från nyast till äldst, men hjälp utav en usort funktion som är inbyggt i php. Vi gör även en limit på frågorna så endast tre stycken kommer att visas på förstasidan. (Även taggarna och användarna är limiterade till tre). Sedan hämtar vi alla taggar och vi kallar på en funktion som gör en count i sql för att räkna vilka taggar som används mest. Och för att se dom mest aktiva användarna kallar vi på en funktion som gör ganska mycket faktiskt. I våra fyra tabeller (Frågor/Svar/Kommentarer för frågor och svar) så vill vi räkna användarnamnet för att se vart den har gjort de olika sakerna i databasen, sedan har vi fyra funktioner som lägger till all aktivitet i en array. Som sedan i våran först nämna funktion kan lägga in våran databas räkning som en parameter till de andra funktionerna, och sedan sparar vi allt till en topActivity array.

Projektet gör att köras med "make test" utan några problem. Det är även länkat till Travis, CircleCI, Scrutinizer och CodeClimate. Scrutinizer har gett mig kodkvalitet på 9.54 som jag är nöjd med och CodeClimate har gett mig B som betyg.


##### Krav 4
För att kunna markera att ett svar är accepterat så måste vi i våran viewAction i QuestionController kolla att fråga id:et på användaren som skapat den är samma som session id:et, och är den det så sätter vi variabeln isAuthor till sant annars till falskt, sedan i våran vy kollar vi om isAuthor är sant, och är den det så lägger vi till en knapp så man kan markera en fråga som accepterat, och trycker man på den knappen kallar vi på funktione nmarkAcceptedAnswerAction som sätter våran accepted fält i databas tabellen till sant och sparar det.

För att kunna ge en up-vote eller down-vote så har jag skapat fyra nya tabeller och klasser, dom gör alla samma sak, fast till olika objekt (fråga/svar/kommentarer). I tabellerna finns ett fält som heter "vote" och det är den som bestämmer betyget, 1 är en up-vote, 0 är neutral och -1 är en down-vote. Om en användare klickar på "-" så kommer downVoteXXXX kallas, och den kommer kolla om användaren redan har röstat eller inte, har den inte det så läggs -1 till i vote fältet annars händer inget. Samma sak händer med upVoteXXXX fast vi gör ett +1 istället. När vi sedan vill lägga ihop summan av alla röster så har vi fyra nya funktioner som heter countVoteForXXXX och där hämtar vi summan av alla röster i databasen.

Sedan vill vi kunna sortera svaren på en fråga med datum och rank, och för att göra det har jag lagt till en ny parameter i våran viewAction funktion i QuestionController, som är $sort, vi kollar om $sort är 'date' eller 'rank' och beroende på vilket det är så kallar vi på en callback funktion genom usort som kollar vilken som är nyast och vilken som har högst rank. Men, pga av att jag har gjort på detta sätt så måste alla länkar som är till view/id/ ha date eller rank efter, annars kommer inte länkarna fungera korrekt, därför som default är det alltid sorterat efter datum.

På översikten av alla frågorna vill vi kunna se antalet svar och rank, därför har jag i min indexAction i QuestionController två kontroller som vi kollar den ena hämtar alla svar för en specifik fråga, och den andra hämtar den sammanlagda ranken (poängen) ifrån en specifik fråga.


##### Krav 5
Vi vill skapa ett poängsystem för användaren, så att den kan få ett rykte. Mitt rykte fungerar på det sättet att ställa en fråga ger 2 poäng, att svara en fråga ger 3 poäng och att göra kommentarer ger 1 poäng. I min UserController så har jag min viewAction, och i den kallar jag på fyra funktioner som hämtar statistiken av användaren, även dom fungerar väldigt likt varandra med endast andra namn, i de funktonerna gör vi en sql sats som hämtar summan och antalet av alla frågor/svar/kommentarer som användaren har gjort och lägger sedan till det i en stats array. Sedan i våran viewAction för att lägga ihop allting så lägger vi till allt i en reputation variabel där vi adderar och multiplicerar så som vi vill ha poängen.

Vi har redan sedan tidigare skrivit ut vad användaren har frågat/svarat/kommenterat på så vi lägger endast in vårat rykte.


##### Om Projektet
Jag tycker att det har varit ett roligt projekt, väldigt utmanande. Det tog ett tag att komma igång för att förstå hur allt ska kopplas ihop. Men i helhet tycker jag att det har gått bra att genomföra, skulle föredra att ha ett mer specifikt krav för 6:an då jag inte riktigt kom på något att göra. Jag kan även känna att om vi skulle gjort ett projekt till (matmod) så hade jag inte hunnit med dom optionella kraven.


##### Om Kursen
Jag tycker att det har varit en bra kurs, jag har lärt mig väldigt mycket. Och det har varit roligt att fördjupa sig mer inom ramverket, däremot hade jag hellre jobbat med ett känt ramverk som t.ex. Laravel för när vi väl kommer till arbetsmarknaden så har inte Anax mycket betydelse mer än att vi har lärt oss grunderna om ramverk. Men förutom det så har vi i alla fal fått undersöka dom andra ramverken på sidan om. I helhet, en bra kurs där jag har lärt mig mycket. Jag skulle rekommendera den här kursen till dom är intresserade utav php och ramverk. Kursen får 8 utav 10 av mig i betyg.
